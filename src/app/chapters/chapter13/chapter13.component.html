<div class="chapter-container">
    <!-- Header -->
    <div class="chapter-header">
      <h1>Chapter 13: Digital Signatures</h1>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="getProgress()"></div>
      </div>
      <p class="section-info">Section {{currentSection}} of {{totalSections}}: {{getSectionTitle()}}</p>
    </div>
  
    <!-- Navigation -->
    <div class="section-nav">
      <button (click)="previousSection()" [disabled]="currentSection === 1" class="nav-btn">
        ← Previous
      </button>
      <div class="section-dots">
        <span *ngFor="let section of [].constructor(totalSections); let i = index" 
              class="dot" 
              [class.active]="currentSection === i + 1"
              (click)="goToSection(i + 1)">
          {{i + 1}}
        </span>
      </div>
      <button (click)="nextSection()" [disabled]="currentSection === totalSections" class="nav-btn">
        Next →
      </button>
    </div>
  
    <!-- Section 1: Defining Digital Signatures -->
    <div *ngIf="currentSection === 1" class="section">
      <div class="hero-section">
        <h2 class="hero-title">
          <span class="signature-icon">✍️</span>
          What Is a Digital Signature?
        </h2>
        
        <div class="hero-concept">
          <div class="concept-highlight">
            <div class="concept-icon">🔒</div>
            <div class="concept-text">
              <p>A <strong>digital signature</strong> is a cryptographic mechanism that provides mathematical proof of authenticity and integrity for digital messages or documents.</p>
              <p class="concept-subtitle">Unlike handwritten signatures, digital signatures offer <em>unbreakable mathematical security</em>.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="definition-showcase">
        <h3 class="section-header">
          <span class="header-icon">⚙️</span>
          Formal Definition
        </h3>
        <div class="algorithm-cards">
          <div class="algorithm-card key-gen">
            <div class="card-icon">🔑</div>
            <h4>Key Generation</h4>
            <p>Generates a public-private key pair</p>
            <div class="formula-mini">(pk, sk) ← KeyGen()</div>
          </div>
          
          <div class="algorithm-card signing">
            <div class="card-icon">✏️</div>
            <h4>Signing</h4>
            <p>Creates signature with private key</p>
            <div class="formula-mini">σ ← Sign(m, sk)</div>
          </div>
          
          <div class="algorithm-card verification">
            <div class="card-icon">✅</div>
            <h4>Verification</h4>
            <p>Validates signature with public key</p>
            <div class="formula-mini">Verify(m, σ, pk) → {{'{'}}✓, ✗{{'}'}}</div>
          </div>
        </div>
      </div>

      <div class="math-foundation">
        <h3 class="section-header">
          <span class="header-icon">🧮</span>
          Mathematical Foundation
        </h3>
        <div class="math-container">
          <div class="math-explanation">
            <p>Digital signatures rely on <strong>asymmetric cryptography</strong> with one-way mathematical functions:</p>
          </div>
          <div class="formula-showcase">
            <div class="formula-card primary">
              <div class="formula-label">Signing Process</div>
              <div class="formula-content">σ = Sign(m, sk)</div>
            </div>
            <div class="formula-arrow">→</div>
            <div class="formula-card secondary">
              <div class="formula-label">Verification Process</div>
              <div class="formula-content">Verify(m, σ, pk)</div>
            </div>
          </div>
          <div class="security-note">
            <span class="note-icon">🛡️</span>
            <p><strong>Security Guarantee:</strong> Computationally infeasible to forge signatures without the private key, even with knowledge of the public key and many valid signatures.</p>
          </div>
        </div>
      </div>

      <div class="security-trinity">
        <h3 class="section-header">
          <span class="header-icon">🛡️</span>
          The Security Trinity
        </h3>
        <div class="trinity-grid">
          <div class="trinity-card authentication">
            <div class="trinity-icon">🔐</div>
            <h4>Message Authentication</h4>
            <div class="trinity-details">
              <div class="detail-item">
                <strong>What:</strong> Proves message origin
              </div>
              <div class="detail-item">
                <strong>How:</strong> Private key uniqueness
              </div>
              <div class="detail-item">
                <strong>Example:</strong> Email sender verification
              </div>
            </div>
          </div>
          
          <div class="trinity-card integrity">
            <div class="trinity-icon">🛡️</div>
            <h4>Message Integrity</h4>
            <div class="trinity-details">
              <div class="detail-item">
                <strong>What:</strong> Detects any modifications
              </div>
              <div class="detail-item">
                <strong>How:</strong> Hash-based validation
              </div>
              <div class="detail-item">
                <strong>Example:</strong> Software update verification
              </div>
            </div>
          </div>
          
          <div class="trinity-card non-repudiation">
            <div class="trinity-icon">📋</div>
            <h4>Non-Repudiation</h4>
            <div class="trinity-details">
              <div class="detail-item">
                <strong>What:</strong> Prevents denial of signing
              </div>
              <div class="detail-item">
                <strong>How:</strong> Cryptographic proof
              </div>
              <div class="detail-item">
                <strong>Example:</strong> Legal contract binding
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="analogy-section">
        <h3 class="section-header">
          <span class="header-icon">🏛️</span>
          Historical Perspective
        </h3>
        <div class="analogy-container">
          <div class="analogy-visual">
            <div class="wax-seal">🏺</div>
            <div class="evolution-arrow">⟶</div>
            <div class="digital-signature">💻</div>
          </div>
          <div class="analogy-comparison">
            <div class="historical-method">
              <h4>Medieval Wax Seal</h4>
              <div class="method-features">
                <div class="feature">🔑 Unique signet ring</div>
                <div class="feature">🛡️ Tamper evidence</div>
                <div class="feature">👑 Authority proof</div>
              </div>
            </div>
            <div class="modern-method">
              <h4>Digital Signature</h4>
              <div class="method-features">
                <div class="feature">🔐 Mathematical uniqueness</div>
                <div class="feature">⚡ Instant verification</div>
                <div class="feature">🌐 Global validity</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="impact-section">
        <h3 class="section-header">
          <span class="header-icon">🌟</span>
          Why Digital Signatures Transform Everything
        </h3>
        <div class="impact-grid">
          <div class="impact-card economy">
            <div class="impact-icon">🌐</div>
            <h4>Digital Economy Revolution</h4>
            <p>Enable trillion-dollar online transactions without physical presence or paper trails</p>
            <div class="impact-stat">$4.9T+ in digital transactions annually</div>
          </div>
          
          <div class="impact-card legal">
            <div class="impact-icon">⚖️</div>
            <h4>Legal Framework Evolution</h4>
            <p>Recognized as legally binding in 180+ countries under electronic signature laws</p>
            <div class="impact-stat">99.9% court acceptance rate</div>
          </div>
          
          <div class="impact-card security">
            <div class="impact-icon">🔒</div>
            <h4>Unbreakable Security</h4>
            <p>Mathematically impossible to forge with current computational capabilities</p>
            <div class="impact-stat">2^256 security level</div>
          </div>
          
          <div class="impact-card scale">
            <div class="impact-icon">📊</div>
            <h4>Infinite Scalability</h4>
            <p>Process millions of signatures per second with automated verification systems</p>
            <div class="impact-stat">1M+ signatures/second</div>
          </div>
        </div>
      </div>

      <div class="technical-deep-dive">
        <h3 class="section-header">
          <span class="header-icon">🔬</span>
          Technical Deep Dive: Hash-then-Sign
        </h3>
        <div class="process-flow">
          <div class="flow-step">
            <div class="step-number">1</div>
            <div class="step-content">
              <h4>Hash Computation</h4>
              <div class="step-formula">h = Hash(message)</div>
              <p>Creates fixed-size digest</p>
            </div>
          </div>
          
          <div class="flow-arrow">→</div>
          
          <div class="flow-step">
            <div class="step-number">2</div>
            <div class="step-content">
              <h4>Signature Generation</h4>
              <div class="step-formula">σ = Sign(h, private_key)</div>
              <p>Signs the hash value</p>
            </div>
          </div>
          
          <div class="flow-arrow">→</div>
          
          <div class="flow-step">
            <div class="step-number">3</div>
            <div class="step-content">
              <h4>Verification</h4>
              <div class="step-formula">Verify(Hash(message), σ, public_key)</div>
              <p>Validates authenticity</p>
            </div>
          </div>
        </div>
        
        <div class="benefits-showcase">
          <h4>Why Hash First?</h4>
          <div class="benefit-items">
            <div class="benefit-item">
              <span class="benefit-icon">⚡</span>
              <strong>Speed:</strong> Constant-time signing regardless of message size
            </div>
            <div class="benefit-item">
              <span class="benefit-icon">📏</span>
              <strong>Size:</strong> Fixed signature length for any message
            </div>
            <div class="benefit-item">
              <span class="benefit-icon">🔒</span>
              <strong>Security:</strong> Ties to collision-resistant hash functions
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Section 2: Conventional vs Digital Signatures -->
    <div *ngIf="currentSection === 2" class="section">
      <h2>Conventional vs. Digital Signatures</h2>
      
      <div class="comparison-table">
        <div class="comparison-header">
          <div class="aspect-col">Aspect</div>
          <div class="conventional-col">Conventional Signature</div>
          <div class="digital-col">Digital Signature</div>
        </div>
        
        <div *ngFor="let comparison of comparisonAspects" class="comparison-row">
          <div class="aspect-col">
            <strong>{{comparison.aspect}}</strong>
          </div>
          <div class="conventional-col">
            {{comparison.conventional}}
          </div>
          <div class="digital-col">
            {{comparison.digital}}
          </div>
        </div>
      </div>
  
      <div class="insight-box">
        <h3>Key Insight</h3>
        <p>Digital signatures provide <strong>message-specific authentication</strong> - each signature is unique to its message and cannot be reused, unlike conventional signatures that remain the same across documents.</p>
      </div>
    </div>
  
    <!-- Section 3: The Digital Signature Process -->
    <div *ngIf="currentSection === 3" class="section">
      <h2>The Digital Signature Process</h2>
      
      <div class="process-demo">
        <h3>Interactive Signing Process</h3>
        
        <div class="process-steps">
          <div class="step" [class.active]="processStep >= 1" [class.completed]="processStep > 1">
            <div class="step-number">1</div>
            <div class="step-content">
              <h4>Hash Message</h4>
              <p>Compute secure hash of the message</p>
              <div *ngIf="processHash" class="step-result">
                Hash: <code>{{processHash}}</code>
              </div>
            </div>
          </div>
  
          <div class="step" [class.active]="processStep >= 2" [class.completed]="processStep > 2">
            <div class="step-number">2</div>
            <div class="step-content">
              <h4>Generate Signature</h4>
              <p>Apply signing algorithm with private key</p>
              <div *ngIf="processSignature" class="step-result">
                Signature: <code>{{processSignature}}</code>
              </div>
            </div>
          </div>
  
          <div class="step" [class.active]="processStep >= 3" [class.completed]="processStep > 3">
            <div class="step-number">3</div>
            <div class="step-content">
              <h4>Verify Signature</h4>
              <p>Use public key to verify authenticity</p>
              <div *ngIf="processStep > 3" class="step-result">
                Result: <span [class.valid]="processVerified" [class.invalid]="!processVerified">
                  {{processVerified ? 'VERIFIED' : 'FAILED'}}
                </span>
              </div>
            </div>
          </div>
        </div>
  
        <div class="process-controls">
          <div class="input-group">
            <label>Message to Sign:</label>
            <input [(ngModel)]="processMessage" class="message-input">
          </div>
          <button (click)="executeProcessStep()" class="process-btn">
            <span *ngIf="processStep === 1">Hash Message</span>
            <span *ngIf="processStep === 2">Generate Signature</span>
            <span *ngIf="processStep === 3">Verify Signature</span>
            <span *ngIf="processStep === 4">Reset Process</span>
          </button>
        </div>
      </div>
  
      <div class="security-note">
        <h3>Why Hash First?</h3>
        <p>Signing the digest (hash) rather than the full message dramatically reduces computational effort and ties security to the strength of the hash function.</p>
      </div>
    </div>
  
    <!-- Section 4: Security Services Provided -->
    <div *ngIf="currentSection === 4" class="section">
      <h2>Security Services Provided</h2>
      
      <div class="services-grid">
        <div *ngFor="let service of securityServices; let i = index" 
             class="service-card" 
             [class.active]="service.active"
             (click)="toggleSecurityService(i)">
          <h3>{{service.name}}</h3>
          <p>{{service.description}}</p>
          <div class="service-example">
            <strong>Example:</strong> {{service.example}}
          </div>
          <div class="service-status">
            {{service.active ? 'ENABLED' : 'DISABLED'}}
          </div>
        </div>
      </div>
  
      <div class="layered-security">
        <h3>Layered Security</h3>
        <p>Digital signatures can be combined with encryption to provide both <strong>confidentiality</strong> and <strong>authentication</strong>:</p>
        <div class="security-layers">
          <div class="layer">Sign-then-Encrypt: Sign(message) → Encrypt(signed_message)</div>
          <div class="layer">Encrypt-then-Sign: Encrypt(message) → Sign(encrypted_message)</div>
        </div>
      </div>
    </div>
  
    <!-- Section 5: Digital Signature Schemes -->
    <div *ngIf="currentSection === 5" class="section">
      <h2>Digital Signature Schemes</h2>
      
      <div class="scheme-selector">
        <div class="scheme-tabs">
          <button *ngFor="let scheme of signatureSchemes" 
                  (click)="selectScheme(scheme)"
                  [class.active]="selectedScheme === scheme"
                  class="scheme-tab">
            {{scheme.name}}
          </button>
        </div>
      </div>
  
      <div class="scheme-details">
        <h3>{{selectedScheme.name}} Signature Scheme</h3>
        <p>{{selectedScheme.description}}</p>
        
        <div class="scheme-properties">
          <div class="property">
            <strong>Security Basis:</strong> {{selectedScheme.securityBasis}}
          </div>
          <div class="property">
            <strong>Signature Size:</strong> {{selectedScheme.signatureSize}}
          </div>
          <div class="property">
            <strong>Performance:</strong> {{selectedScheme.performance}}
          </div>
          <div class="property">
            <strong>Key Size:</strong> {{selectedScheme.keySize}} bits
          </div>
        </div>
      </div>
  
      <!-- RSA Implementation Demo -->
      <div *ngIf="selectedScheme.name === 'RSA'" class="implementation-demo">
        <h4>RSA Signature Implementation</h4>
        
        <div class="rsa-demo">
          <div class="key-generation">
            <button (click)="generateRSAKeys()" [disabled]="rsaGenerating" class="generate-btn">
              <span *ngIf="rsaGenerating">Generating...</span>
              <span *ngIf="!rsaGenerating">Generate RSA Keys</span>
            </button>
            
            <div *ngIf="rsaKeyPair" class="key-display">
              <div class="key-pair">
                <div><strong>n:</strong> {{rsaKeyPair.n.toString()}}</div>
                <div><strong>e:</strong> {{rsaKeyPair.e.toString()}}</div>
                <div><strong>d:</strong> {{rsaKeyPair.d.toString()}}</div>
              </div>
            </div>
          </div>
  
          <div *ngIf="rsaKeyPair" class="signing-demo">
            <div class="input-group">
              <label>Message to Sign:</label>
              <input [(ngModel)]="rsaMessage" class="message-input">
            </div>
            
            <div class="demo-controls">
              <button (click)="signRSAMessage()" class="sign-btn">Sign Message</button>
              <button (click)="verifyRSASignature()" [disabled]="!rsaSignature" class="verify-btn">Verify Signature</button>
            </div>
  
            <div *ngIf="rsaSignature" class="signature-result">
              <div><strong>Signature:</strong> <code>{{rsaSignature}}</code></div>
            </div>
  
            <div *ngIf="rsaVerificationResult" class="verification-result" 
                 [class.valid]="rsaVerificationResult === 'Valid'"
                 [class.invalid]="rsaVerificationResult === 'Invalid'">
              <strong>Verification:</strong> {{rsaVerificationResult}}
            </div>
          </div>
        </div>
      </div>
  
      <!-- ElGamal Implementation Demo -->
      <div *ngIf="selectedScheme.name === 'ElGamal'" class="implementation-demo">
        <h4>ElGamal Signature Implementation</h4>
        
        <div class="elgamal-demo">
          <div class="parameters">
            <h5>Parameters:</h5>
            <div class="param-display">
              <div><strong>p:</strong> {{elGamalP.toString()}} (prime)</div>
              <div><strong>g:</strong> {{elGamalG.toString()}} (generator)</div>
              <div><strong>x:</strong> {{elGamalX.toString()}} (private key)</div>
              <div><strong>h:</strong> {{elGamalH.toString()}} (public key = g^x mod p)</div>
            </div>
          </div>
  
          <div class="signing-demo">
            <div class="input-group">
              <label>Message to Sign:</label>
              <input [(ngModel)]="elGamalMessage" class="message-input">
            </div>
            
            <button (click)="signElGamalMessage()" class="sign-btn">Generate ElGamal Signature</button>
  
            <div *ngIf="elGamalR > 0 && elGamalS > 0" class="signature-result">
              <div><strong>Signature (r, s):</strong></div>
              <div>r = {{elGamalR.toString()}}</div>
              <div>s = {{elGamalS.toString()}}</div>
              <div class="verification-status" [class.valid]="verifyElGamalSignature()">
                Verification: {{verifyElGamalSignature() ? 'VALID' : 'INVALID'}}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Section 6: Scheme Comparison -->
    <div *ngIf="currentSection === 6" class="section">
      <h2>Signature Scheme Comparison</h2>
      
      <div class="comparison-controls">
        <button (click)="toggleSchemeComparison()" class="comparison-btn">
          <span *ngIf="schemeComparison">Hide</span>
          <span *ngIf="!schemeComparison">Show</span>
          Detailed Comparison
        </button>
        <button (click)="runPerformanceBenchmark()" [disabled]="benchmarkRunning" class="benchmark-btn">
          <span *ngIf="benchmarkRunning">Running...</span>
          <span *ngIf="!benchmarkRunning">Run Performance Benchmark</span>
        </button>
      </div>
  
      <div *ngIf="schemeComparison" class="detailed-comparison">
        <table class="comparison-table-detailed">
          <thead>
            <tr>
              <th>Scheme</th>
              <th>Security Basis</th>
              <th>Signature Size</th>
              <th>Performance</th>
              <th>Key Size</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let scheme of signatureSchemes">
              <td><strong>{{scheme.name}}</strong></td>
              <td>{{scheme.securityBasis}}</td>
              <td>{{scheme.signatureSize}}</td>
              <td>{{scheme.performance}}</td>
              <td>{{scheme.keySize}} bits</td>
            </tr>
          </tbody>
        </table>
      </div>
  
      <div *ngIf="performanceResults.length > 0" class="performance-results">
        <h3>Performance Benchmark Results</h3>
        <div class="results-grid">
          <div *ngFor="let result of performanceResults" class="result-card">
            <h4>{{result.scheme}}</h4>
            <div class="metric">
              <span class="label">Signing:</span>
              <span class="value">{{result.signingTime}}ms</span>
            </div>
            <div class="metric">
              <span class="label">Verification:</span>
              <span class="value">{{result.verificationTime}}ms</span>
            </div>
            <div class="metric">
              <span class="label">Key Size:</span>
              <span class="value">{{result.keySize}} bits</span>
            </div>
            <div class="metric">
              <span class="label">Signature Size:</span>
              <span class="value">{{result.signatureSize}} bits</span>
            </div>
          </div>
        </div>
      </div>
  
      <div class="recommendation-engine">
        <h3>Scheme Recommendations</h3>
        <div class="recommendations">
          <div class="recommendation">
            <strong>High Security, Large Keys OK:</strong> RSA-4096
          </div>
          <div class="recommendation">
            <strong>Balanced Security & Performance:</strong> ECDSA P-256
          </div>
          <div class="recommendation">
            <strong>Compact Signatures:</strong> Schnorr or EdDSA
          </div>
          <div class="recommendation">
            <strong>Government/FIPS Compliance:</strong> DSS/DSA
          </div>
        </div>
      </div>
    </div>
  
    <!-- Section 7: Variations & Applications -->
    <div *ngIf="currentSection === 7" class="section">
      <h2>Variations & Applications</h2>
      
      <div class="applications-selector">
        <div class="app-tabs">
          <button *ngFor="let app of applications" 
                  (click)="selectApplication(app)"
                  [class.active]="selectedApplication === app"
                  class="app-tab">
            {{app.name}}
          </button>
        </div>
      </div>
  
      <div class="application-details">
        <h3>{{selectedApplication.name}}</h3>
        <p>{{selectedApplication.description}}</p>
        
        <div class="app-example">
          <strong>Examples:</strong> {{selectedApplication.example}}
        </div>
  
        <div class="app-benefits">
          <h4>Key Benefits:</h4>
          <ul>
            <li *ngFor="let benefit of selectedApplication.benefits">{{benefit}}</li>
          </ul>
        </div>
      </div>
  
      <div class="special-variants">
        <h3>Special Signature Variants</h3>
        
        <div class="variant-cards">
          <div class="variant-card">
            <h4>Blind Signatures</h4>
            <p>Enable signing without revealing message content - used in e-cash and anonymous voting systems.</p>
            <div class="variant-formula">
              Blind: m' = m · r^e mod n<br>
              Sign: s' = (m')^d mod n<br>
              Unblind: s = s' · r^(-1) mod n
            </div>
          </div>
  
          <div class="variant-card">
            <h4>Time-Stamped Signatures</h4>
            <p>Include trusted timestamps to prove signature existed at specific time - prevents replay attacks.</p>
            <div class="variant-example">
              Signature + RFC 3161 Timestamp = Legal proof of signing time
            </div>
          </div>
  
          <div class="variant-card">
            <h4>Multi-Signatures</h4>
            <p>Multiple parties sign the same message - used in blockchain consensus and multi-party authorization.</p>
            <div class="variant-example">
              Threshold: k-of-n signatures required for validity
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Section 8: Active Learning & Exercises -->
    <div *ngIf="currentSection === 8" class="section">
      <h2>Active Learning & Exercises</h2>
      
      <div class="exercises-grid">
        <div *ngFor="let exercise of exercises" class="exercise-card" [class.completed]="exercise.completed">
          <div class="exercise-header">
            <h3>{{exercise.name}}</h3>
            <span class="difficulty-badge" [class]="'difficulty-' + exercise.difficulty.toLowerCase()">
              {{exercise.difficulty}}
            </span>
          </div>
          
          <p>{{exercise.description}}</p>
          
          <div class="exercise-controls">
            <button (click)="startExercise(exercise)" class="exercise-btn">
              <span *ngIf="exercise.completed">Reset Exercise</span>
              <span *ngIf="!exercise.completed">Start Exercise</span>
            </button>
          </div>
          
          <div *ngIf="exercise.completed" class="completion-status">
            ✓ Exercise Completed
          </div>
        </div>
      </div>
  
      <div class="chapter-summary">
        <h3>Chapter 13 Summary</h3>
        <div class="summary-points">
          <div class="summary-point">
            <strong>Digital Signatures</strong> provide authentication, integrity, and non-repudiation
          </div>
          <div class="summary-point">
            <strong>Hash-then-Sign</strong> approach reduces computational cost and improves security
          </div>
          <div class="summary-point">
            <strong>Multiple Schemes</strong> available: RSA, ElGamal, Schnorr, DSS, ECDSA
          </div>
          <div class="summary-point">
            <strong>Trade-offs</strong> exist between security, performance, and signature size
          </div>
          <div class="summary-point">
            <strong>Applications</strong> span from code signing to blockchain transactions
          </div>
        </div>
      </div>
  
      <div class="learning-outcomes">
        <h3>Learning Outcomes Achieved</h3>
        <div class="outcomes-checklist">
          <div class="outcome">✓ Understand digital signature fundamentals</div>
          <div class="outcome">✓ Compare different signature schemes</div>
          <div class="outcome">✓ Implement RSA and ElGamal signatures</div>
          <div class="outcome">✓ Analyze security properties and trade-offs</div>
          <div class="outcome">✓ Apply signatures to real-world scenarios</div>
        </div>
      </div>
    </div>
  </div>
  